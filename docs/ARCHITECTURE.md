# Архитектура AI Career Pathfinder

Краткое описание потока данных и компонентов для защиты/онбординга.

## Общий поток

1. **Ввод:** профессия + грейд, навыки (PDF или вручную: скиллсет / свой навык с подсказками).
2. **Нормализация навыков:** «свой навык» сначала проверяется по словарю синонимов и стеммингу (`skill_normalizer`), при отсутствии совпадения — семантический маппинг через RAG (`map_to_canonical_skill`).
3. **Сценарий:** пользователь выбирает цель — следующий грейд / смена профессии / исследование возможностей.
4. **Расчёт:** для выбранного сценария подставляются целевые требования (роль + грейд), выполняется gap-анализ (атлас + навыки); для «Исследование» — ранжирование по совпадению и опционально по RAG.
5. **Вывод:** шаг 1 (диагностика) форматируется из структурированного анализа и RAG; шаг 2 (план 70/20/10) генерируется LLM по сжатой диагностике и RAG-контексту.

## Компоненты

| Компонент | Назначение |
|-----------|------------|
| **main.py** | Gradio UI, вызов парсера, сценариев, форматтера; валидация и сообщения об ошибках. |
| **data_loader** | Справочники `clean_skills.json`, `atlas_params_clean.json`. Требования по роли/грейду, список профессий, скиллсет по профессии. |
| **resume_parser** | Извлечение текста из PDF (pypdf), обрезка по длине; парсинг навыков через OpenAI с валидацией JSON и retry. |
| **skill_normalizer** | Стемминг (NLTK Snowball RU/EN), словарь синонимов `data/skill_synonyms.json`. `resolve_to_canonical()` — маппинг ввода на канонический навык. |
| **rag_service** | Эмбеддинги (sentence-transformers), Qdrant REST. Поиск, подсказки навыков, объяснения разрывов, семантическое ранжирование возможностей. Ограничение длины чанков навыков. |
| **scenario_handler** | Три сценария: next_grade, change_profession, explore_opportunities — возврат целевых требований или списка возможностей. |
| **gap_analyzer** | Сравнение user_skills с target_requirements; разбиение на разрывы по атласу и по навыкам, приоритет по величине разрыва. |
| **next_grade_service / switch_profession_service / explore_recommendations** | Детализация сценариев: нарратив по грейду, baseline для смены профессии, категории closest/adjacent/far. |
| **output_formatter** | Markdown: сводка в начале, диагностика, план 70/20/10. Вызов PlanGenerator с сжатым шагом 1 и RAG-контекстом. |
| **plan_generator** | LLM (OpenAI): сжатая диагностика + RAG в промпте, max_tokens, retry при ошибках. |

## Данные

- **clean_skills.json** — навыки с привязкой к профессиям, уровнями, примерами задач.
- **atlas_params_clean.json** — параметры атласа по грейдам (Младший … Эксперт).
- **skill_synonyms.json** — синонимы/варианты написания → каноническое название навыка.
- **Qdrant** (опционально) — индекс навыков + атласа для RAG.

## Ограничения контекста и надёжность

- Резюме обрезается до `RESUME_TEXT_MAX_CHARS` символов перед отправкой в LLM.
- Диагностика (шаг 1) перед отправкой в план 70/20/10 сжимается до ~1000 символов; полный RAG-контекст передаётся отдельно.
- Ответ плана ограничен `max_tokens`; при ошибке API — retry с backoff, затем fallback-текст.
